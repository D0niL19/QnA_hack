import fitz  # PyMuPDF

# Шаг 1: Извлечение текста из PDF
def extract_text_from_pdf(pdf_file):
    doc = fitz.open(pdf_file)
    pages_text = []

    # Итерация по страницам PDF
    for page_num in range(len(doc)):
        page = doc.load_page(page_num)
        text = page.get_text("text")
        pages_text.append({"page_num": page_num + 1, "text": text})

    return pages_text

# Шаг 2: Разбиение текста на фрагменты по количеству символов без скользящего окна
def split_text_into_chunks(text, chunk_size=200):
    words = text.split()
    chunks = []
    current_chunk = ""

    for word in words:
        # Проверка, помещается ли текущее слово в текущий чанк
        if len(current_chunk) + len(word) + 1 <= chunk_size:  # +1 для пробела
            if current_chunk:  # Если текущий чанк не пустой, добавляем пробел
                current_chunk += " "
            current_chunk += word
        else:
            if current_chunk:  # Если текущий чанк не пустой, добавляем его в список чанков
                chunks.append(current_chunk)
            current_chunk = word  # Начинаем новый чанк с текущего слова

    # Добавляем последний чанк, если он не пустой
    if current_chunk:
        chunks.append(current_chunk)

    return chunks

# Шаг 3: Подготовка данных для Qdrant (разбиение на страницы и фрагменты)
def prepare_data_for_qdrant(pages_text, chunk_size=200):
    data = []
    for page in pages_text:
        chunks = split_text_into_chunks(page['text'], chunk_size)
        for chunk in chunks:
            data.append({
                "text": chunk,
                "metadata": {
                    "page_num": page['page_num']
                }
            })
    return data



# Пример использования
if __name__ == "__main__":
    ans = {
    "answer": "Here is a question that you should answer based on the given context. Write a response that answers the question using only information provided in the context. Provide the answer in Russia.\n\nбригады на работе с момента явки, но не более двух часов, по истечении которого запрещается отправлять ее в поездку. 5.13. Компенсировать неиспользованное время междусменного отдыха, накопленное в период летних путевых работ Работниками путевых машинных станций, машинистами железнодорожно-строительных машин, ССПС и помощниками машинистов подразделений хозяйства пути, путем предоставления дополнительного отдыха по окончании периода летних путевых работ, но не позднее 31 декабря текущего года, или присоединения этого времени к ежегодному отпуску в те же сроки, с оплатой отработанных в период летних путевых работ, но неоплаченных часов, исходя из тарифной ставки (оклада), установленной на дату оплаты. В случае если неиспользованное время междусменного отдыха не предоставлено Работникам до 31 декабря текущего года полностью, то соответствующее количество отработанных в период летних путевых работ, но не оплаченных в период летних путевых работ, должно быть оплачено как сверхурочная работа, исходя из тарифной ставки (оклада), установленной на Номер страницы: 17\n20 5.20. Предоставлять Работникам ежегодный основной оплачиваемый отпуск продолжительностью 28 календарных дней, Работникам, являющимся инвалидами, - 30 календарных дней, Работникам в возрасте до 18 лет - 31 календарный день. 5.21. Предоставлять дополнительный оплачиваемый отпуск Работникам, условия труда на рабочих местах которых по результатам специальной оценки условий труда отнесены к вредным условиям труда 2-й, 3-й или 4-й степени или опасным условиям труда, продолжительностью 7 календарных дней. Предоставлять дополнительный оплачиваемый отпуск продолжительностью 14 календарных дней машинистам и помощникам машинистов электровозов, тепловозов, паровозов, электропоездов, дизель- поездов, рельсовых автобусов, кочегарам паровозов в депо, условия труда на рабочих местах которых по результатам специальной оценки условий труда отнесены к вредным условиям труда любой степени или опасным условиям труда. Сохранять размеры дополнительных оплачиваемых отпусков, предоставляемых по состоянию на 1 января 2014 года Работникам, условия труда, на рабочих местах которых по результатам специальной оценки условий труда (аттестации рабочих мест) отнесены к вредным условиям труда любой степени или опасным условиям труда, при условии сохранения соответствующих условий труда на рабочем месте, явившихся основанием для назначения данной компенсационной меры. На основании согласия Работника, оформленного путем заключения дополнительного соглашения к трудовому договору в письменной форме или в форме электронного документа в Номер страницы: 20\n21 и ее компонентов. 5.23. Предоставлять Работникам дополнительный отпуск за ненормированный рабочий день в соответствии с правилами внутреннего трудового распорядка и перечнем профессий и должностей, утвержденным Компанией с учетом мотивированного мнения выборного органа Профсоюза. 5.24. Предоставлять Работникам иные ежегодные дополнительные оплачиваемые отпуска в случаях, предусмотренных законодательством Российской Федерации и локальными нормативными актами Компании. 5.25. Предоставлять, при наличии производственных возможностей, по заявлению, поданному в письменной или электронной форме в установленном порядке, отпуск без сохранения заработной платы продолжительностью до 14 календарных дней в календарном году в удобное для него время: Работнику, имеющему ребенка в возрасте до 14 лет; Работнику, имеющему ребенка-инвалида в возрасте до 18 лет; Работникам, осуществляющим уход за членом семьи или иным родственником, являющимся инвалидом I группы; Работнику – волонтеру. Такой отпуск по заявлениям Работников указанных категорий, поданным в письменной или электронной форме в установленном порядке, может быть присоединен к ежегодному оплачиваемому отпуску или использован отдельно полностью либо по частям. Перенесение этого отпуска на следующий год не допускается. 5.26. Обеспечивать применение в Компании единой системы нормирования труда на основе централизованной разработки норм затрат труда. Производить введение, замену и пересмотр норм труда (выработки, времени, обслуживания, численности и др.) с учетом достигнутого уровня техники, технологии, организации труда на основе локальных нормативных актов Работодателя, принятых с учетом мотивированного мнения выборного органа Профсоюза. Введение (пересмотр) норм времени и расценок на выполняемые работы в филиалах, структурных подразделениях Компании при отличии в них уровня техники, технологии, организации труда от нормативов, указанных в централизованно разработанных нормах, производить в зависимости от местных условий с учетом мотивированного мнения Номер страницы: 21\nжелезнодорожного транспорта год, за исключением: Работников, указанных в подпунктах «а» и «б» настоящего пункта; Работников, достигших на момент увольнения возраста для назначения пенсии по старости, в том числе на льготных условиях; Работников, указанных в пункте 7.26.; Работников, отказавшихся при создании дочернего (зависимого) общества ОАО «РЖД» от трудоустройства в нем на равноценном рабочем месте. Стаж работы для реализации настоящего подпункта определяется в соответствии с пунктом 7.23. настоящего Договора; г) предоставлять высвобождаемому Работнику по его заявлению, поданному в письменной или электронной форме в установленном порядке, с учетом производственных условий до трех оплачиваемых рабочих дней в месяц с сохранением среднего заработка для самостоятельного поиска работы. При повторном трудоустройстве Работника в Компанию и увольнении в соответствии с условиями, указанными в подпунктах «б» и «в», выплаты выходного пособия, предусмотренные данными подпунктами, осуществляются за каждый отработанный в Компании год после повторного трудоустройства. Размер среднего заработка (средней заработной платы) определяется в порядке, установленном статьей 139 Трудового кодекса Российской Федерации и Положением об особенностях порядка исчисления средней заработной платы, утвержденным постановлением Правительства Российской Федерации от 24 декабря 2007 года № 922, для всех случаев определения ее размера, предусмотренных Трудовым кодексом Российской Федерации, за исключением Номер страницы: 37\n\n\nПравила оформления отпуска без сохранения заработной платы на 1 сентября 2022 года\nПравила оформления отпуска без сохранения заработной платы на 1 сентября 2022 года\nОтпуск без сохранения заработной платы на 1 сентября 2022 года может быть предоставлен по заявлению работника, имеющего ребенка в возрасте до 14 лет, ребенка-инвалида в возрасте до 18 лет, осуществляющего уход за членом семьи или иным родственником, являющимся инвалидом I группы, или являющегося волонтером. Такой отпуск может быть присоединен к ежегодному оплачиваемому отпуску или использован отдельно полностью либо по частям. Перенесение этого отпуска на следующий год не допускается.\n\nДля получения отпуска без сохранения заработной платы на 1 сентября 2022 года работник должен подать заявление в письменной или электронной форме в установленном порядке. Такой отпуск может быть предоставлен в удобное для работника время.\n\nОтпуск без сохранения заработной платы на 1 сентября 2022 года может быть предоставлен в соответствии с правилами внутреннего трудового распорядка и перечнем профессий и должностей, утвержденным Компанией с учетом мотивированного мнения выборного органа Профсоюза.\n\nТаким образом, отпуск без сохранения заработной платы на 1 сентября 2022 года может быть предоставлен по заявлению работника, имеющего ребенка в возрасте до 14 лет, ребенка-инвалида в возрасте до 18 лет, осуществляющего уход за членом семьи или иным родственником, являющимся инвалидом I группы, или являющегося волонтером, в удобное для работника время. Такой отпуск может быть присоединен к ежегодному оплачиваемому отпуску или использован отдельно полностью либо по частям. Перенесение этого отпуска на следующий год не допускается.\n\nПравила оформления отпуска без сохранения заработной платы на 1 сентября 2022 года\nПравила оформления отпуска без сохранения заработной платы на 1 сентября 2022 года\nОтпуск без сохранения заработной платы на 1 сентября 2022 года может быть предоставлен по заявлению работника, имеющего ребенка в возрасте до 14 лет, ребенка-инвалида в возрасте до 18 лет, осуществляющего уход за членом семьи или иным родственником, являющимся инвалидом I группы, или являющегося волонтером. Такой отпуск может быть присоединен к ежегодному оплачиваемому отпуску или использован отдельно полностью либо по частям. Перенесение этого отпуска на следующий год не допускается.\n\nДля получения отпуска без сохранения заработной платы на 1 сентября 2022 года работник должен подать заявление в письменной или электронной форме в установленном порядке. Такой отпуск может быть предоставлен в удобное для работника время.\n\nОтпуск без сохранения заработной платы на 1 сентября 2022 года может быть предоставлен в соответствии с правилами внутреннего трудового распорядка и перечнем профессий и должностей, утвержденным Компанией с учетом мотивированного мнения выборного органа Профсоюза.\n\nТаким образом, отпуск без сохранения заработной платы на 1 сентября 2022 года может быть предоставлен по заявлению работника, имеющего ребенка в возрасте до 14 лет, ребенка-инвалида в возрасте до 18 лет, осуществляющего уход за членом семьи или иным родственником, являющимся инвалидом I группы, или являющегося волонтером, в удобное для работника время. Такой отпуск может"
}
    print(ans["answer"])
